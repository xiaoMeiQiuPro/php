<include file="Public/_header" title=""/>


<div class="page-container">
    <form action="__CONTROLLER__/update" method="post" enctype="multipart/form-data" class="form form-horizontal" id="form-article-add">
        <input type="hidden" class="input-text" value="{$list.goods_id}"  name="goods_id">
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品名字：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input type="text" class="input-text" value="{$list.goods_name}"  required placeholder="" id="" name="goods_name">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品分类：</label>
            <div class="formControls col-xs-8 col-sm-9"> <span class="select-box">
				<select name="cat_id" class="select">
                    <foreach name="cat" item="v">
                        <option   value="{$v.cat_id}"  >{$v.name}</option>
                    </foreach>
                </select>
				</span> </div>
        </div>
        <!--       <div class="row cl">
                   <label class="form-label col-xs-4 col-sm-2">排序值：</label>
                   <div class="formControls col-xs-8 col-sm-9">
                       <input type="text" class="input-text" value="0" placeholder="" id="" name="sort">
                   </div>
               </div>
               <div class="row cl">
                   <label class="form-label col-xs-4 col-sm-2">产品规格：</label>
                   <div class="formControls col-xs-8 col-sm-9">
                       <input type="text" name="" id="" placeholder="输入长度" value="" class="input-text" style=" width:25%">
                       MM
                       <input type="text" name="" id="" placeholder="输入宽度" value="" class="input-text" style=" width:25%">
                       MM
                       <input type="text" name="" id="" placeholder="输入高度" value="" class="input-text" style=" width:25%">
                       MM </div>
               </div>
               <div class="row cl">
                   <label class="form-label col-xs-4 col-sm-2">产地：</label>
                   <div class="formControls col-xs-8 col-sm-9">
                       <input type="text" name="" id="" placeholder="" value="" class="input-text">
                   </div>
               </div>
               <div class="row cl">
                   <label class="form-label col-xs-4 col-sm-2">材质：</label>
                   <div class="formControls col-xs-8 col-sm-9">
                       <input type="text" name="" id="" placeholder="" value="" class="input-text">
                   </div>
               </div>
               <div class="row cl">
                   <label class="form-label col-xs-4 col-sm-2">所属供应商：</label>
                   <div class="formControls col-xs-8 col-sm-9">
                       <input type="text" name="" id="" placeholder="" value="" class="input-text">
                   </div>
               </div>
               <div class="row cl">
                   <label class="form-label col-xs-4 col-sm-2">价格计算单位：</label>
                   <div class="formControls col-xs-8 col-sm-9"> <span class="select-box">
                       <select class="select">
                           <option>请选择</option>
                           <option value="1">件</option>
                           <option value="2">斤</option>
                           <option value="3">KG</option>
                           <option value="4">吨</option>
                           <option value="5">套</option>
                       </select>
                       </span> </div>
               </div>
               <div class="row cl">
                   <label class="form-label col-xs-4 col-sm-2">产品重量：</label>
                   <div class="formControls col-xs-8 col-sm-9">
                       <input type="text" name="" id="" placeholder="" value="" class="input-text" style="width:90%">
                       kg</div>
               </div>-->
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>市场价格：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input type="number" name="market_price" required id="" placeholder="" value="{$list.market_price}" class="input-text" style="width:90%">
                元</div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>本店售价：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input type="number" name="shop_price" required id="" placeholder="" value="{$list.shop_price}" class="input-text" style="width:90%">
                元</div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>运费：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input type="number" name="freight" required id="" placeholder="" value="{$list.freight}" class="input-text" style="width:90%">
                元</div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品库存：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input type="number" name="store_count" required id="" placeholder="" value="{$list.store_count}" class="input-text" style="width:90%">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2">商品图片<small>(第一张作为封面图)</small>：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div class="uploader-list-container">
                    <div class="queueList">
                        <ul class="goods_btn" >
                          <foreach name="goods_img" item="vo">
                            <li  style='float: left;margin-left: 10px;margin-top: 30px;'><img width='186px' height='180px' src="{$vo}"><div onclick='del_img(this)' style='height: 0;'><a title='删除'  class='ml-5' style='text-decoration:none;color: red;'><i class='Hui-iconfont'>&#xe6e2;</i>删除</a></div><input name="goods_img[]" value="{$vo}" type='hidden' /></li>
                          </foreach>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <hr/>
        <div style="clear: left;margin-top: 30px" class="row cl">
            <center>
                <div id="goods_btn" class="btn btn-primary radius">选择图片</div>
            </center>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-2">商品详情：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div class="uploader-list-container">
                    <div class="queueList">
                        <ul class="info_btn" >
                            <foreach name="info_img" item="vo">
                                <li  style='float: left;margin-left: 10px;margin-top: 30px;'><img width='186px' height='180px' src="{$vo}"><div onclick='del_img(this)' style='height: 0;'><a title='删除'  class='ml-5' style='text-decoration:none;color: red;'><i class='Hui-iconfont'>&#xe6e2;</i>删除</a></div><input name="info_img[]" value="{$vo}" type='hidden' /></li>
                            </foreach>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <hr/>
        <div style="clear: left;margin-top: 30px" class="row cl">
            <center>
                <div id="info_btn" class="btn btn-primary radius">选择图片</div>
            </center>
        </div>
        <div class="row cl" style="margin-bottom: 30px">
            <div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-3">
                <input class="btn btn-primary radius" id="ab" type="button" value="提交">
            </div>
        </div>
    </form>
</div>

<script type="text/javascript">
    $(function() {

        $('input[type=radio]').iCheck({
            checkboxClass: 'icheckbox-blue',
            radioClass: 'iradio-blue',
            increaseArea: '20%'
        });
        var id;
        $("#goods_btn,#info_btn").click(function(){
            id = $(this).attr('id');
        });
        var uploader = new plupload.Uploader({
            runtimes: 'html5,flash,silverlight,html4', //上传插件初始化选用那种方式的优先级顺序
            browse_button: ['goods_btn','info_btn'], // 上传按钮
            url: "__CONTROLLER__/upload", //远程上传地址
            flash_swf_url: '__PUBLIC__/plupload/Moxie.swf', //flash文件地址
            silverlight_xap_url: '__PUBLIC__/plupload/Moxie.xap', //silverlight文件地址
            filters: {
                max_file_size: '10mb', //最大上传文件大小（格式100b, 10kb, 10mb, 1gb）
                mime_types:[{
                    title: "files", extensions: "jpg,png,jpeg"
                }]
                //允许文件上传类型
            },
            multi_selection: true, //true:ctrl多文件上传, false 单文件上传
            init:{
                //文件上传前
                FilesAdded: function(up, files) {
                    /* if ($("#ul_pics").children("li").length > 1) {
                     alert("您上传的图片太多了！");
                     uploader.destroy();
                     } else {
                     var li = '';
                     //遍历文件
                     plupload.each(files, function(file) {
                     li += "<li class='close_pic' id='" + file['id'] + "'>   <div class='progress'><span class='bar'></span><span class='percent'>0%</span></div></li>";
                     });
                     $("#ul_pics").append(li);
                     uploader.start();
                     }*/
                    uploader.start();
                },
                //上传中，显示进度条
                /*UploadProgress: function(up, file) {
                 var percent = file.percent;
                 $("#" + file.id

                 ).find('.bar').css({"width": percent + "%"});
                 $("#" + file.id

                 ).find(".percent").text(percent + "%");
                 },*/
                //文件上传成功的时候触发
                FileUploaded: function(up, file, info) {
                    console.log(info);
                    // var data = eval( info.response );
                    var name;
                    if(id=='goods_btn'){
                        name = 'goods_img[]';
                    }
                    else if(id == 'info_btn'){
                        name = 'info_img[]';
                    }
                    var val = "<li  style='float: left;margin-left: 10px;margin-top: 30px;'><img width='186px' height='180px' src="+info.response+"><div onclick='del_img(this)' style='height: 0;'><a title='删除'  class='ml-5' style='text-decoration:none;color: red;'><i class='Hui-iconfont'>&#xe6e2;</i>删除</a></div><input name="+name+" value="+info.response+" type='hidden' /></li>";
                    $("."+id).append(val);
                },
                //上传出错的时候触发
                Error: function(up, err) {
                    layer.msg(err.message);
                }
            }
        });
        uploader.init();

        $("#ab").click(function(){
            var goods_name = $("input[name=goods_name]").val();
            var children_price = $("input[name=children_price]").val();
            var adult_price = $("input[name=adult_price]").val();
            var children_stock = $("input[name=children_stock]").val();
            var adult_stock = $("input[name=adult_stock]").val();
            var start_time = $("input[name=start_time]").val();
            var end_time = $("input[name=end_time]").val();
            var set_time = $("input[name=set_time]").val();
            var set_address = $("input[name=set_address]").val();
            var route = $("input[name=route]").val();
            var explain = $("input[name=explain]").val();
            var freight = $("input[name=freight]").val();
            if(freight==""||goods_name==''||children_price==''||adult_price==''||children_stock==''||adult_stock==''||start_time==''||end_time==''||set_time==''||set_address==''||route==''||explain==''){
                layer.msg('商品信息不能为空',{icon: 2, time: 2000});
                return false;
            }
            else{
                $.ajax({
                    // cache: true,
                    type: "POST",
                    url:"__CONTROLLER__/update",
                    data:$('form').serialize(),// 你的formid
                    async: false,
                    success: function(data) {
                        if(data == 1){
                            var index = parent.layer.getFrameIndex(window.name);
                            parent.location.reload();
                            layer.msg("修改成功", {icon: 1, time: 2000});
                            //  parent.location.href="__CONTROLLER__";
                            setTimeout(function(){
                                parent.layer.close(index);
                            },2000);
                        }
                        else{
                            layer.msg(data, {icon: 2, time: 2000});
                        }
                    },
                    error: function(request) {
                        layer.msg('服务器异常', {icon: 2, time: 2000});
                    }
                });
            }
        })
    });
    function del_img(e
    ){
        // alert(e);

        $(e).parent('li').remove();

    }
</script>
<include file="Public/_footer"  />..



